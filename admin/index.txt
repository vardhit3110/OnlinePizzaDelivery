<?php
session_start();
if (isset($_SESSION['adminloggedin']) && $_SESSION['adminloggedin'] == true) {
    $adminloggedin = true;
    $userId = isset($_SESSION['adminId']) ? $_SESSION['adminId'] : 0;
} else {
    $adminloggedin = false;
    $userId = 0;
}

if ($adminloggedin) {
    // Check for dark mode preference
    if (isset($_COOKIE['darkMode'])) {
        $darkMode = $_COOKIE['darkMode'] === 'true';
    } else {
        $darkMode = false;
    }
    ?>
    <!doctype html>
    <html lang="en">

    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
            integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
            integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
        <title>Admin Page</title>
        <link rel="icon" href="/OnlinePizzaDelivery/img/logo.jpg" type="image/x-icon">

        <link href='https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css' rel='stylesheet'>
        <link rel="stylesheet" href="assetsForSideBar/css/styles.css">
        
        <style>
            .dark-mode {
                background-color: #121212 !important;
                transition: background-color 0.5s ease;
            }
            body {
                transition: background-color 0.5s ease;
            }
            .dark-mode {
                background-color: #121212 !important;
                transition: background-color 0.5s ease;
            }
            body {
                transition: background-color 0.5s ease;
            }
        </style>
    </head>

    <body id="body-pd" style="background: #80808045;" class="<?php echo $darkMode ? 'dark-mode' : ''; ?>">

        <?php
        require 'partials/_dbconnect.php';
        require 'partials/_nav.php';

        if (isset($_GET['loginsuccess']) && $_GET['loginsuccess'] == "true") {
            echo '<div class="alert alert-success alert-dismissible fade show" role="alert" style="width:100%" id="loginAlert">
                    <strong>Success!</strong> You are logged in
                    <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">Ã—</span></button>
                  </div>';
        }
        ?>

        <?php $page = isset($_GET['page']) ? $_GET['page'] : 'home'; ?>
        <?php include $page . '.php' ?>

        <!-- Dark/Light Mode Toggle Button -->
        <div class="mode-toggle" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
            <button id="modeToggle" class="btn btn-secondary">
                <i class="<?php echo $darkMode ? 'fas fa-sun' : 'fas fa-moon'; ?>"></i>
            </button>
        </div>

        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
        <script src="https://unpkg.com/bootstrap-show-password@1.2.1/dist/bootstrap-show-password.min.js"></script>
        <script src="assetsForSideBar/js/main.js"></script>
        
        <script>
            // Auto slide up the alert after 1 seconds
            $(document).ready(function () {
                setTimeout(function () {
                    $('#loginAlert').slideUp(400);
                }, 1000);
                
                // Dark/Light mode toggle - background only with animation
                $('#modeToggle').click(function() {
                    $('body').toggleClass('dark-mode');
                    const isDarkMode = $('body').hasClass('dark-mode');
                    
                    // Update icon
                    $(this).find('i').toggleClass('fa-sun fa-moon');
                    
                    // Set cookie that expires in 30 days
                    const expires = new Date();
                    expires.setTime(expires.getTime() + (30 * 24 * 60 * 60 * 1000));
                    document.cookie = `darkMode=${isDarkMode}; expires=${expires.toUTCString()}; path=/`;
                });
            });
        </script>

    </html>
    <?php
} else {
    header("location: /OnlinePizzaDelivery/admin/login.php");
}
?>